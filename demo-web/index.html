<!DOCTYPE HTML>
<!--
	Hyperspace by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<!--Header-->
<head>
    <meta charset="utf-8">
    <title>Interactive Video Captioning demo</title>
    <link rel="shortcut icon" href="images/logoPRHLT-whitefill.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <!-- core CSS -->
    <!-- Bootstrap -->
    <!--<link rel="stylesheet" href="assets/css/bootstrap.min.css">-->
    <link rel="stylesheet" href="assets/css/normalize.css">
    <link rel="stylesheet" href="assets/css/ion.rangeSlider.css">
    <link rel="stylesheet" href="assets/css/ion.rangeSlider.skinHTML5.css">

    <!--Main-->
    <link rel="stylesheet" href="assets/css/main.css"/>


    <!--Scripts-->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.scrollex.min.js"></script>
    <script src="assets/js/jquery.scrolly.min.js"></script>
    <script src="assets/js/skel.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/ie/html5shiv.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/ion.rangeSlider.js"></script>

</head>

<!--HTML body -->
<body>

<!-- Sidebar -->
<section id="sidebar-top">
    <div class="inner">
        <nav>
            <ul>
                <!--<li>    <a href="http://www.prhlt.upv.es/"><img src="images/logoPRHLT-whitefill.svg" height="100%"  /></a></li>-->
                <li><a href="#inmt">Interactive Neural Video Captioning</a></li>
                <li><a href="#moreinfo">More info</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
    </div>
</section>

<!-- Wrapper -->

<div id="wrapper">

    <!-- INMT-Demo  -->
    <section id="inmt" class="wrapper style1 fullscreen fade-up">
        <div class="inner">
            <h1>Interactive neural video captioning </h1>
            <h4> Demo of an interactive neural video captioning system based on the toolkit <a href="https://github.com/lvapeab/nmt-keras">NMT-Keras</a>.<br></h4>
            <p>
                Instructions:<ol>
                    <li> Watch each video. </li>
                    <li> Next, click on the "Transcript!" button for obtaining the automatic transcription in of the video.  </li>
                    <li> If the transcription is not correct, you can make corrections: </li>
                    <ol>
                        <li>Use the mouse or the keyboard arrows to select the position where to introduce the correction.</li>
                        <li>Type the correction.</li>
                        <li>Type "/" for introducing an end-of-sentence symbol.</li>
                    </ol>
                    <li> The system will react to these interactions, providing alternative transcription hypotheses.</li>
                    <li> Once you are satisfied with the transcription, click in the "Validate" button and go to the next sentence. </li>
                    <li> If <i>Learn from sample</i> is activated, the system will use this sentence pair for improving the model. </li>
                </ol>
            </p>

            <p>
                Select a task to transcript.
                <select id="document-list" name="document-list" onload="handleDefaultFile(this.value)" onChange="handleDefaultFile(this.value)">
                    <option disabled selected value="msvd"> &#45;&#45; select a dataset &#45;&#45; </option>
                    <option value="flickr8k">Flickr8k images</option>
                    <option value="msvd">Youtube videos</option>
                </select>
            </p>
            <!--<div style='padding:4px'>-->
                <!--<p>Alternatively, you can upload your own data. It should be a plain-text file with one sentence per line.</p>-->
                <!--<ul class="actions">-->
                    <!--<li><input type="file" id="files" name="file"/></li>-->
                    <!--<li><button onclick="abortRead();">Cancel read</button></li>-->
                <!--</ul>-->
            <!--</div>-->
                <!--<button onclick="instructions();">Instructions</button>-->
                <!--<p class="alert alert-info fade in" id="instructions" style="display:none;">-->
                    <!--Upload a file with the sentences to translate.-->
                    <!--Once loaded, click on each "Transcript" button for obtaining the automatic transcription.-->
                    <!--If the transcription is not correct, you can make corrections. The system will react to-->
                    <!--these interactions, providing alternative transcription hypotheses.-->
                    <!--Once you are satisfied with the transcription, click in the "Validate" button and go to the next sentence.-->
                    <!--<a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>-->
                <!--</p>-->
                <!--<p class="alert alert-warning" id="abortread" style="display:none;">Reading interrupted.</p>-->
                <!--<p class="alert alert-error"   id="errormissing" style="display:none;">File Not Found!</p>-->
                <!--<p class="alert alert-error"   id="errorread" style="display:none;">File is not readable!</p>-->
                <!--<p class="alert alert-error"   id="defaulterror" style="display:none;">An error occurred reading this-->
                    <!--file.</p>-->
                <!--<div id="progress_bar">-->
                    <!--<div class="percent">0%</div>-->
                <!--</div>-->
            <div>
                <a href="#moreinfo" class="button scrolly">More info</a>
            </div>

            <!--Search options    -->
            <span style="font-size:30px;cursor:pointer" onclick="changSearchOptionsClass()">&#9654; Show decoding options</span>
            <div id="search_options" class="vertnav">
                <table style="width:80%">
                    <tr>
                        <td style="vertical-align:middle"><p> <b>Beam size</b>: Number of hypotheses running in parallel.</p></td> </td> <td> <input id="beam-size-slider" type="text" value="6" name="beam-size-slider" />  </td>
                    </tr>
                    <tr>
                        <td style="vertical-align:middle"><p> <b>Length penalty</b>: Length normalization factor.</p> </td> <td> <input id="length-norm-slider" type="text" value="0" name="length-norm-slider" />  </td>
                    </tr>
                    <tr>
                        <td style="vertical-align:middle"><p>  <b>Coverage penalty</b>:  Coverage normalization factor.</p></td> <td><input id="coverage-norm-slider" type="text" value="0" name="coverage-norm-slider" /></td>
                    </tr>
                    <tr>
                        <td style="vertical-align:middle"><p> <b>Length normalization</b>: Normalize hypotheses according to their length powered to this factor.</td> <td><input id="alpha-slider" type="text" value="1" name="alpha-slider" /></td>
                    </tr>
                </table>
            </div>

        </div>
        <div class="container">
            <div name="DisplayArea" class="tableDiv" id='DisplayArea'></div>
        </div>
        <div class='container alert-bottom-fixed alert alert-success fade in' id='accept' style='display:none;'>
            Video validated. <a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>
        </div>
    </section>

    <!-- More info -->
    <section id="moreinfo" class="wrapper style1 fullscreen fade-up">
        <div class="inner">
            <h1>More info</h1>
            <p>All systems were developed based on the open-source toolkit <a href="https://github.com/lvapeab/nmt-keras">NMT-Keras</a>.<br/>
            Interactive pattern recognition is a framework that aims at diminishing the effort required for correcting transcriptions from a system. For more info, look the following papers:</p>

            <div class="features">
                <p>
                    <a href="https://ufal.mff.cuni.cz/pbml/111/art-peris-casacuberta.pdf"
                       class="icon fa-file-pdf-o fa-2x" style="font-size:20px"> NMT-Keras: a Very Flexible Toolkit with a Focus on Interactive NMT and Online Learning</a><br/>
                     Álvaro Peris, Francisco Casacuberta. <br/>
                    In <em> The Prague Bulletin of Mathematical Linguistics vol. 111, pp. 113-124</em>, 2018.
                </p>
            </div>

            <div class="features">
                <p>
                    <a href="https://arxiv.org/abs/1802.03594"
                       class="icon fa-file-pdf-o fa-2x" style="font-size:20px">
                    Online Learning for Effort Reduction in Interactive Neural Machine Translation</a><br/>
                    Álvaro Peris and Francisco Casacuberta. <br/>
                    In <em>arXiv:1802.03594</em>, 2018.</p>
            </div>

            <div class="features">
                <p>
                    <a href="https://ufal.mff.cuni.cz/pbml/111/art-peris-casacuberta.pdf"
                       class="icon fa-file-pdf-o fa-2x" style="font-size:20px"> Video description using bidirectional recurrent neural networks</a><br/>
                     Álvaro Peris, Marc Bolaños, Petia Radeva and Francisco Casacuberta. <br/>
                    In <em>International Conference on Artificial Neural Networks, 3-11</em>, 2016.
                </p>
            </div>

            <div style='padding:15px'>
                <ul class="actions">
                    <li><a href="#contact" class="button scrolly">More</a></li>
                </ul>
            </div>
        </div>

    </section>

    <!-- contact -->
    <section id="contact" class="wrapper style1 fade-up">
        <div class="inner">
            <ul class="icons">
            <h1>Contact:
                <li><a href="mailto:lvapeab@gmail.com" class="fa-envelope-o"><span class="label">Gmail</span></a>
                <a href="https://www.prhlt.upv.es/u/lvapeab" class="fa-globe"><span class="label">PRHLT</span></a>
                <a href="https://github.com/lvapeab/nmt-keras" class="fa-github"><span class="label">GitHub</span></a></li>
                </h1>
            </ul>
        </div>

    </section>

    <!-- Footer -->
    <footer id="footer" class="wrapper style1-alt">
        <div class="inner">
            <ul class="menu">
                <li>&copy; Álvaro Peris. 2018. All rights reserved.</li>
                <li>Design: HTML5 UP</li>
            </ul>
        </div>
    </footer>
</div>



</body>



<!-- Java Scripts-->
<!--INMT-->

<script language="javascript" type="text/javascript">
    function trimAll(sString) {
        while (sString.substring(0, 1) == ' ') {
            sString = sString.substring(1, sString.length);
        }
        while (sString.substring(sString.length - 1, sString.length) == ' ') {
            sString = sString.substring(0, sString.length - 1);
        }
        return sString;
    }
    function instructions() {
        var instructions = $('#instructions');
        instructions.show();
    }

    function encodeHTML(s) {
        return s.split('&').join('&amp;').split('<').join('&lt;').split('"').join('&quot;').split("'").join('&#39;');
    }
    function write_interactive_caption_video(field_number) {
        var vid_idx = document.getElementById('vidinmt_' + field_number).getAttribute("vid_idx"); //the text area's id
        var hypothesis = null;

        // Retrieve search options
        var beam_size = $("#beam-size-slider").data("ionRangeSlider").result.from;
        var length_norm = $("#length-norm-slider").data("ionRangeSlider").result.from;
        var coverage_norm = $("#coverage-norm-slider").data("ionRangeSlider").result.from;
        var alpha_norm = $("#alpha-slider").data("ionRangeSlider").result.from;
        var php_sampler_url = "sampler.php" + "?vid_idx=" + vid_idx + "&beam_size=" + beam_size + "&length_norm=" + length_norm + "&coverage_norm=" + coverage_norm + "&alpha_norm=" + alpha_norm;

            try {
                //Good Browsers
                var xmlHttp = new XMLHttpRequest();
            } catch (e) {
                //Internet Explorer
                try {
                    heatControlRequest = new ActiveXObject("Msxml2.XMLHTTP");
                } catch (e) {
                    try {
                        heatControlRequest = new ActiveXObject("Microsoft.XMLHTTP");
                    } catch (e) {
                        alert("Brower not supported");
                        return false;
                    }
                }
            }

            xmlHttp.open("GET", php_sampler_url, false);
            xmlHttp.send();
            hypothesis = document.getElementById('hypothesis_' + field_number);
            hypothesis.value = xmlHttp.responseText;
            hypothesis.donetyping = function (callback, delay) {
                delay || (delay = 20);
                var timeoutReference;
                var doneTyping = function (elt) {
                    if (!timeoutReference) return;
                    timeoutReference = null;
                    callback(elt);
                };

                $(document).each(function () {
                    var self = $(hypothesis);
                    self.is(':input') && self.on('keyup paste', function (e) {
                        var code = (e.keyCode || e.which);
                        if ((code < 48 || code > 90) && code != 32 && code != 188 && code != 190 && code != 173 && code != 171  && (code < 96 || code > 111)) return;
                        if (timeoutReference) clearTimeout(timeoutReference);
                        timeoutReference = setTimeout(function () {
                            doneTyping(self);
                        }, delay);
                    }).on('blur', function () {
                        doneTyping(self);
                    });
                });
                return hypothesis;
            };
            hypothesis.donetyping(function () {
                var vid_idx = document.getElementById('vidinmt_' + field_number).getAttribute("vid_idx"); //the text area's id
                var transcription_inmt_field = hypothesis; // document.getElementById('hypothesis_' + field_number); //$('#transcription-inmt');
                var prefix = transcription_inmt_field.value;
                var startPosition = transcription_inmt_field.selectionStart;

                if (startPosition > 0){
                    var prefix2 = prefix.slice(0, startPosition).replace(/ /gi, "%20");
                    var php_sampler_url = "inmt_sampler.php" + "?vid_idx=" + vid_idx + "&prefix=" + prefix2 + '&learn=False' + "&beam_size=" + beam_size + "&length_norm=" + length_norm + "&coverage_norm=" + coverage_norm + "&alpha_norm=" + alpha_norm;
                    try {
                        //Good Browsers
                        var xmlHttp = new XMLHttpRequest();
                    } catch (e) {
                        //Internet Explorer
                        try {
                            heatControlRequest = new ActiveXObject("Msxml2.XMLHTTP");
                        } catch (e) {
                            try {
                                heatControlRequest = new ActiveXObject("Microsoft.XMLHTTP");
                            } catch (e) {
                                alert("Brower not supported");
                                return false;
                            }
                        }
                    }
                    xmlHttp.open("GET", php_sampler_url, false);
                    xmlHttp.send();
                    $(transcription_inmt_field).val(xmlHttp.responseText);
                    transcription_inmt_field.selectionStart = startPosition;
                    transcription_inmt_field.selectionEnd = startPosition;
                    }
            });
    }
    function accept_transcription(field_number) {

        var vid_idx = document.getElementById('vidinmt_' + field_number).getAttribute("vid_idx");
        var hypothesis = document.getElementById('hypothesis_' + field_number).value;

        // Retrieve search options
        var beam_size = $("#beam-size-slider").data("ionRangeSlider").result.from;
        var length_norm = $("#length-norm-slider").data("ionRangeSlider").result.from;
        var coverage_norm = $("#coverage-norm-slider").data("ionRangeSlider").result.from;
        var alpha_norm = $("#alpha-slider").data("ionRangeSlider").result.from;

        if (trimAll(hypothesis) === '') {
            var inmt_empty_string = $('#inmtemptystring');
            inmt_empty_string.show();
            inmt_empty_string.fadeOut(2000);
        }
        var learn_from_sample = $('#ol_checkbox_' + field_number + ':checked').val();

        if (learn_from_sample == 'True') {
            var php_sampler_url = "inmt_sampler.php" + "?vid_idx=" + vid_idx + "&prefix=" + hypothesis + '&learn=' + learn_from_sample + "&beam_size=" + beam_size + "&length_norm=" + length_norm + "&coverage_norm=" + coverage_norm + "&alpha_norm=" + alpha_norm;

            try {
                //Good Browsers
                var xmlHttp = new XMLHttpRequest();
            } catch (e) {
                //Internet Explorer
                try {
                    heatControlRequest = new ActiveXObject("Msxml2.XMLHTTP");
                } catch (e) {
                    try {
                        heatControlRequest = new ActiveXObject("Microsoft.XMLHTTP");
                    } catch (e) {
                        alert("Brower not supported");
                        return false;
                    }
                }
            }
            xmlHttp.open("GET", php_sampler_url, false);
            xmlHttp.send();
        }

        var accept_alert = $('#accept');
        accept_alert.text('Video #' + field_number + ' validated.');
        accept_alert.show();
        accept_alert.fadeOut(2000);
    }


    function write_interactive_caption_image(field_number) {
        var vid_idx = document.getElementById('img_' + field_number).getAttribute("vid_idx"); //the text area's id
        var hypothesis = null;

        // Retrieve search options
        var beam_size = $("#beam-size-slider").data("ionRangeSlider").result.from;
        var length_norm = $("#length-norm-slider").data("ionRangeSlider").result.from;
        var coverage_norm = $("#coverage-norm-slider").data("ionRangeSlider").result.from;
        var alpha_norm = $("#alpha-slider").data("ionRangeSlider").result.from;
        var php_sampler_url = "sampler_image.php" + "?vid_idx=" + vid_idx + "&beam_size=" + beam_size + "&length_norm=" + length_norm + "&coverage_norm=" + coverage_norm + "&alpha_norm=" + alpha_norm;

            try {
                //Good Browsers
                var xmlHttp = new XMLHttpRequest();
            } catch (e) {
                //Internet Explorer
                try {
                    heatControlRequest = new ActiveXObject("Msxml2.XMLHTTP");
                } catch (e) {
                    try {
                        heatControlRequest = new ActiveXObject("Microsoft.XMLHTTP");
                    } catch (e) {
                        alert("Brower not supported");
                        return false;
                    }
                }
            }

            xmlHttp.open("GET", php_sampler_url, false);
            xmlHttp.send();
            hypothesis = document.getElementById('img_hypothesis_' + field_number);
            hypothesis.value = xmlHttp.responseText;
            hypothesis.donetyping = function (callback, delay) {
                delay || (delay = 20);
                var timeoutReference;
                var doneTyping = function (elt) {
                    if (!timeoutReference) return;
                    timeoutReference = null;
                    callback(elt);
                };

                $(document).each(function () {
                    var self = $(hypothesis);
                    self.is(':input') && self.on('keyup paste', function (e) {
                        var code = (e.keyCode || e.which);
                        if ((code < 48 || code > 90) && code != 32 && code != 188 && code != 190 && code != 173 && code != 171  && (code < 96 || code > 111)) return;
                        if (timeoutReference) clearTimeout(timeoutReference);
                        timeoutReference = setTimeout(function () {
                            doneTyping(self);
                        }, delay);
                    }).on('blur', function () {
                        doneTyping(self);
                    });
                });
                return hypothesis;
            };
            hypothesis.donetyping(function () {
                var vid_idx = document.getElementById('img_' + field_number).getAttribute("vid_idx"); //the text area's id
                var transcription_inmt_field = hypothesis; // document.getElementById('hypothesis_' + field_number); //$('#transcription-inmt');
                var prefix = transcription_inmt_field.value;
                var startPosition = transcription_inmt_field.selectionStart;

                if (startPosition > 0){
                    var prefix2 = prefix.slice(0, startPosition).replace(/ /gi, "%20");
                    var php_sampler_url = "inmt_sampler_image.php" + "?vid_idx=" + vid_idx + "&prefix=" + prefix2 + '&learn=False' + "&beam_size=" + beam_size + "&length_norm=" + length_norm + "&coverage_norm=" + coverage_norm + "&alpha_norm=" + alpha_norm;
                    try {
                        //Good Browsers
                        var xmlHttp = new XMLHttpRequest();
                    } catch (e) {
                        //Internet Explorer
                        try {
                            heatControlRequest = new ActiveXObject("Msxml2.XMLHTTP");
                        } catch (e) {
                            try {
                                heatControlRequest = new ActiveXObject("Microsoft.XMLHTTP");
                            } catch (e) {
                                alert("Brower not supported");
                                return false;
                            }
                        }
                    }
                    xmlHttp.open("GET", php_sampler_url, false);
                    xmlHttp.send();
                    $(transcription_inmt_field).val(xmlHttp.responseText);
                    transcription_inmt_field.selectionStart = startPosition;
                    transcription_inmt_field.selectionEnd = startPosition;
                    }
            });
    }
    function accept_transcription_image(field_number) {

        var vid_idx = document.getElementById('img_' + field_number).getAttribute("vid_idx");
        var hypothesis = document.getElementById('img_hypothesis_' + field_number).value;

        // Retrieve search options
        var beam_size = $("#beam-size-slider").data("ionRangeSlider").result.from;
        var length_norm = $("#length-norm-slider").data("ionRangeSlider").result.from;
        var coverage_norm = $("#coverage-norm-slider").data("ionRangeSlider").result.from;
        var alpha_norm = $("#alpha-slider").data("ionRangeSlider").result.from;

        if (trimAll(hypothesis) === '') {
            var inmt_empty_string = $('#inmtemptystring');
            inmt_empty_string.show();
            inmt_empty_string.fadeOut(2000);
        }
        var learn_from_sample = $('#ol_checkbox_' + field_number + ':checked').val();

        if (learn_from_sample == 'True') {
            var php_sampler_url = "inmt_sampler_image.php" + "?vid_idx=" + vid_idx + "&prefix=" + hypothesis + '&learn=' + learn_from_sample + "&beam_size=" + beam_size + "&length_norm=" + length_norm + "&coverage_norm=" + coverage_norm + "&alpha_norm=" + alpha_norm;

            try {
                //Good Browsers
                var xmlHttp = new XMLHttpRequest();
            } catch (e) {
                //Internet Explorer
                try {
                    heatControlRequest = new ActiveXObject("Msxml2.XMLHTTP");
                } catch (e) {
                    try {
                        heatControlRequest = new ActiveXObject("Microsoft.XMLHTTP");
                    } catch (e) {
                        alert("Brower not supported");
                        return false;
                    }
                }
            }
            xmlHttp.open("GET", php_sampler_url, false);
            xmlHttp.send();
        }

        var accept_alert = $('#accept');
        accept_alert.text('Image #' + field_number + ' validated.');
        accept_alert.show();
        accept_alert.fadeOut(2000);
    }

</script>

<!--Search options-->
<script>

    function changSearchOptionsClass()
    {
        document.getElementById("search_options").classList.toggle("show");
    }

    $(function () {
        $("#beam-size-slider").ionRangeSlider({
            hide_min_max: true,
            keyboard: true,
            min: 1,
            max: 31,
            from: 6,
            type: 'single',
            step: 1,
            prefix: "",
            grid: true,
            grid_num: 6
        });
        $("#length-norm-slider").ionRangeSlider({
            hide_min_max: true,
            keyboard: true,
            min: 0,
            max: 1,
            from: 0,
            type: 'single',
            step: 0.1,
            prefix: "",
            grid: true,
            grid_num: 10
        });
        $("#coverage-norm-slider").ionRangeSlider({
            hide_min_max: true,
            keyboard: true,
            min: 0,
            max: 1,
            from: 0,
            type: 'single',
            step: 0.1,
            prefix: "",
            grid: true,
            grid_num: 10
        });
        $("#alpha-slider").ionRangeSlider({
            hide_min_max: true,
            keyboard: true,
            min: 0,
            max: 5,
            from: 1,
            type: 'single',
            step: 0.1,
            prefix: "",
            grid: true,
            grid_num: 10
        });

    });
</script>

<!--Reader-->
<script>
    var reader;
    var progress = document.querySelector('.percent');
    var sourceDisplayArea = document.getElementById('DisplayArea');

    function abortRead() {
        reader.abort();
    }
    function errorHandler(evt) {
        switch (evt.target.error.code) {
            case evt.target.error.NOT_FOUND_ERR:
                var errormissing = $('#errormissing');
                errormissing.show();
                errormissing.fadeOut(2000);
                break;
            case evt.target.error.NOT_READABLE_ERR:
                var errorread = $('#errorread');
                errorread.show();
                errorread.fadeOut(2000);
                break;
                break;
            case evt.target.error.ABORT_ERR:
                break; // noop
            default:
                var defaulterror = $('#defaulterror');
                defaulterror.show();
                defaulterror.fadeOut(2000);
                break;
        }
    }
    function updateProgress(evt) {
        // evt is an ProgressEvent.
        if (evt.lengthComputable) {
            var percentLoaded = Math.round((evt.loaded / evt.total) * 100);
            // Increase the progress bar length.
            if (percentLoaded < 100) {
                progress.style.width = percentLoaded + '%';
                progress.textContent = percentLoaded + '%';
            }
        }
    }
    function split_line_into_spans(line, id){
            var split_html = '';
            var new_line = line.replace(/(\r\n\t|\n|\r\t)/gm,"");
            var line_words = new_line.split(' ');
            for (var j = 0; j < line_words.length; j++) {
                var sentence_id = id + "_word_" + j;
                split_html += '<span class="editable-token" id="' + sentence_id + '">' + line_words[j] + '</span>';
                split_html += '<span class="editable-space" id="' + id + '_space_' + j + '">  </span>';
            }
            return split_html;
    }
    function handleFileSelect(evt) {
        readObjectFile(evt.target.files[0]);
    }
    function readObjectFile(srcfile) {
        // Reset progress indicator on new file selection.
        progress.style.width = '0%';
        progress.textContent = '0%';
        reader = new FileReader();
        reader.onerror = errorHandler;
        reader.onprogress = updateProgress;
        reader.onabort = function (e) {
            var abortread = $('#abortread');
            abortread.show();
            abortread.fadeOut(2000);
        };
        reader.onloadstart = function (e) {
            document.getElementById('progress_bar').className = 'loading';
        };
        reader.onload = function (e) {
            // Ensure that the progress bar displays 100% at the end.
            progress.style.width = '100%';
            progress.textContent = '100%';
            setTimeout("document.getElementById('progress_bar').className='';", 2000);
            var html_table = "<table  id=\"DisplayTable\"  style=\"width: auto; overflow: auto; display: block;\"  >";
            var results = reader.result.split("\n");
             for (var i = 0; i < results.length; i++) {
                var source_line = results[i];
                var source_html = "";
                source_html = split_line_into_spans(source_line, "vidinmt_" + i);
                 html_table +=
                        "<tr>" +
                            "<td>" +
                                "<div style=\"margin-left:7%\">Video #" + i + "</div>" +
                            "</td>" +
                        "</tr>" +
                        "<tr>" +
                            "<td>" +
//                                    "<div style=\"margin-left:7% class=\"source item\">" +
                                        "<div class=\"editarea\" " +
                                            "vid_idx=\"" + source_line + "\"" +
                                            "name=\"source_sentence_" + i + "\" id=\"vidinmt_" + i + "\">" + source_html +
                                        "</div>" + // Close edit area invisible
//                                    "</div>" + // Close source item div
                            "</td>" +
                            "<td>" +
                                "<div style=\"margin-left:7% class=\"source item\">" +
                                    "<textarea " +
                                        "name=\"hypothesis_" + i + "\" id=\"hypothesis_" + i +
                                        "\"placeholder=\"Click in the transcript button to obtain a transcription.\">" +
                                    "</textarea>" +
                                "</div>" + // Close source item div

//                                "</div>" + // Close div wrap
                            "</td>" +
                        "</tr>" +
                        "<tr>" +
                            "<td>" +
                                    "<div style=\"float: right; padding-right:100px\">" +
                                        "<form onsubmit=\"write_interactive_tranlation(" + i + "); return false;\">" +
                                        "<button type=\"submit\" class=\"button\">Transcript!</button>" +
                                        "</form>" +
                                "</div>" +
                            "</td>" +
                            "<td>" +
                                "<div style=\"float: right; padding-right:100px\">" +
                                    "<form onsubmit=\"accept_transcription(" + i + "); return false;\">" +
//                                        "Learn from sample <input type=\"checkbox\" name=\"OL-checkbox_\"" + i + "\" id=\"ol_checkbox_" + i + "\" value=\"True\" checked>" +
                                        "Learn from sample <label class=\"container\"><input type=\"checkbox\" name=\"OL-checkbox_\"" + i + "\" id=\"ol_checkbox_" + i + "\" value=\"True\" checked> <span class=\"checkmark\"></span></label>" +
                                        "<button type=\"submit\" class=\"button\">Accept transcription</button>"+
                                    "</form>" +
                                "</div>" +
                            "</td>" +
                        "</tr>";
//                 alert(html_table);
             }

            html_table += "</table>";
            DisplayArea.innerHTML = html_table;
        };
        reader.readAsText(srcfile);
    }


//    document.getElementById('files').addEventListener('change', handleFileSelect, false);
    function handleDefaultFile(url) {
        // Hardcoded samples. TODO: Find a better way for doing this
        var msvd_table = "<table  id=\"DisplayTable\"  style=\"width: 100%; overflow: auto; display: absolute;\"><tr><td style=\"text-align:right; padding-right:100px\"><div style=\"margin-left:7%; margin-right:0;\">Video #1</div></td></tr><tr><td  style=\"text-align:right; padding-right:100px\"> <iframe id=\"vidinmt_0\" vid_idx=0 src=\"https://www.youtube.com/embed/TsLi3zZESXM\" width=\"100%\" height=\"320\" modestbranding=\"1\" autohide=\"1\" rel=\"0\" frameborder=\"0\" allow=\"encrypted-media\" allowfullscreen></iframe> </td><td><textarea  width=\"100%\" height=\"320\"  name=\"hypothesis_0\" id=\"hypothesis_0\"placeholder=\"Click in the transcript button to obtain a transcription.\"></textarea></td></tr><tr><td><div style=\"float: right; padding-right:100px\"><form onsubmit=\"write_interactive_caption_video(0); return false;\"><button type=\"submit\" class=\"button\">Transcript!</button></form></div></td><td><div style=\"float: left; padding-right:100px\"><form onsubmit=\"accept_transcription(0); return false;\">Learn from sample <input type=\"checkbox\" name=\"OL-checkbox_\"0\" id=\"ol_checkbox_0\" value=\"True\" checked> <button type=\"submit\" class=\"button\">Accept transcription</button></form></div></td></tr> <tr><td style=\"text-align:right; padding-right:100px\"><div style=\"margin-left:7%\">Video #2</div></td></tr><tr><td style=\"text-align:right; padding-right:100px\"> <iframe  id=\"vidinmt_1\" vid_idx=2 src=\"https://www.youtube.com/embed/QoYQVSqyCwE\" width=\"7%\" height=\"320\" frameborder=\"0\" allow=\"encrypted-media\" allowfullscreen></iframe> </td><td><div style=\"margin-left:7% class=\"source item\"><textarea name=\"hypothesis_1\" id=\"hypothesis_1\"placeholder=\"Click in the transcript button to obtain a transcription.\"></textarea></div></td></tr><tr><td><div style=\"float: right; padding-right:100px\"><form onsubmit=\"write_interactive_caption_video(1); return false;\"><button type=\"submit\" class=\"button\">Transcript!</button></form></div></td><td><div style=\"float: left; padding-right:100px\"><form onsubmit=\"accept_transcription(1); return false;\">Learn from sample <input type=\"checkbox\" name=\"OL-checkbox_\"1\" id=\"ol_checkbox_0\" value=\"True\" checked> <button type=\"submit\" class=\"button\">Accept transcription</button></form></div></td></tr><tr><td style=\"text-align:right; padding-right:100px\"><div style=\"margin-left:7%\">Video #3</div></td></tr><tr><td style=\"text-align:right; padding-right:100px\"> <iframe  id=\"vidinmt_2\" vid_idx=3 src=\"https://www.youtube.com/embed/9kLaatqBr9s\" width=\"7%\" height=\"320\" frameborder=\"0\" allow=\"encrypted-media\" allowfullscreen></iframe> </td><td><div style=\"margin-left:7% class=\"source item\"><textarea name=\"hypothesis_2\" id=\"hypothesis_2\"placeholder=\"Click in the transcript button to obtain a transcription.\"></textarea></div></td></tr><tr><td><div style=\"float: right; padding-right:100px\"><form onsubmit=\"write_interactive_caption_video(2); return false;\"><button type=\"submit\" class=\"button\">Transcript!</button></form></div></td><td><div style=\"float: left; padding-right:100px\"><form onsubmit=\"accept_transcription(2); return false;\">Learn from sample <input type=\"checkbox\" name=\"OL-checkbox_\"2\" id=\"ol_checkbox_0\" value=\"True\" checked> <button type=\"submit\" class=\"button\">Accept transcription</button></form></div></td></tr><tr><td style=\"text-align:right; padding-right:100px\"><div style=\"margin-left:7%\">Video #4</div></td></tr><tr><td style=\"text-align:right; padding-right:100px\"> <iframe  id=\"vidinmt_3\" vid_idx=4 src=\"https://www.youtube.com/embed/LaXXnfKYZlU\" width=\"7%\" height=\"320\" frameborder=\"0\" allow=\"encrypted-media\" allowfullscreen></iframe> </td><td><div style=\"margin-left:7% class=\"source item\"><textarea name=\"hypothesis_3\" id=\"hypothesis_3\"placeholder=\"Click in the transcript button to obtain a transcription.\"></textarea></div></td></tr><tr><td><div style=\"float: right; padding-right:100px\"><form onsubmit=\"write_interactive_caption_video(3); return false;\"><button type=\"submit\" class=\"button\">Transcript!</button></form></div></td><td><div style=\"float: left; padding-right:100px\"><form onsubmit=\"accept_transcription(3); return false;\">Learn from sample <input type=\"checkbox\" name=\"OL-checkbox_\"3\" id=\"ol_checkbox_0\" value=\"True\" checked> <button type=\"submit\" class=\"button\">Accept transcription</button></form></div></td></tr><tr><td style=\"text-align:right; padding-right:100px\"><div style=\"margin-left:7%\">Video #5</div></td></tr><tr><td style=\"text-align:right; padding-right:100px\"> <iframe  id=\"vidinmt_4\" vid_idx=5 src=\"https://www.youtube.com/embed/erT_gCgsqFU\" width=\"7%\" height=\"320\" frameborder=\"0\" allow=\"encrypted-media\" allowfullscreen></iframe> </td><td><div style=\"margin-left:7% class=\"source item\"><textarea name=\"hypothesis_4\" id=\"hypothesis_4\"placeholder=\"Click in the transcript button to obtain a transcription.\"></textarea></div></td></tr><tr><td><div style=\"float: right; padding-right:100px\"><form onsubmit=\"write_interactive_caption_video(4); return false;\"><button type=\"submit\" class=\"button\">Transcript!</button></form></div></td><td><div style=\"float: left; padding-right:100px\"><form onsubmit=\"accept_transcription(4); return false;\">Learn from sample <input type=\"checkbox\" name=\"OL-checkbox_\"4\" id=\"ol_checkbox_0\" value=\"True\" checked> <button type=\"submit\" class=\"button\">Accept transcription</button></form></div></td></tr></table>";

        var flick8k_table = "<table  id=\"DisplayTable\"  style=\"width: 100%; overflow: auto; display: absolute;\"><tr><td style=\"text-align:right; padding-right:3%\"><div style=\"margin-left:7%; margin-right:0;\">Image #1</div></td></tr><tr><td  style=\"text-align:right; padding-right:3%\">  <img style=\"height: 80%; width: 80%; max-height: 420px; object-fit: contain\" id=\"img_0\" vid_idx=0 src=\"Flickr8k_samples/3385593926_d3e9c21170.jpg\" alt=\"Image_1\"> </td><td><textarea  width=\"100%\"  name=\"img_hypothesis_0\" id=\"img_hypothesis_0\"placeholder=\"Click in the transcript button to obtain a transcription.\"></textarea></td></tr><tr><td><div style=\"float: right; padding-right:3%\"><form onsubmit=\"write_interactive_caption_image(0); return false;\"><button type=\"submit\" class=\"button\">Transcript!</button></form></div></td><td><div style=\"float: left; padding-right:3%\"><form onsubmit=\"accept_transcription_image(0); return false;\">Learn from sample <input type=\"checkbox\" name=\"img_OL-checkbox_\"0\" id=\"img_ol_checkbox_0\" value=\"True\" checked> <button type=\"submit\" class=\"button\">Accept transcription</button></form></div></td></tr> <tr><td style=\"text-align:right; padding-right:3%\"><div style=\"margin-left:7%\">Image #2</div></td></tr><tr><td style=\"text-align:right; padding-right:3%\">  <img style=\"height: 80%; width: 80%; max-height: 420px; object-fit: contain\" id=\"img_1\" vid_idx=1 src=\"Flickr8k_samples/2677656448_6b7e7702af.jpg\" alt=\"Image_2\"> </td><td><div style=\"margin-left:7% class=\"source item\"><textarea name=\"img_hypothesis_1\" id=\"img_hypothesis_1\"placeholder=\"Click in the transcript button to obtain a transcription.\"></textarea></div></td></tr><tr><td><div style=\"float: right; padding-right:3%\"><form onsubmit=\"write_interactive_caption_image(1); return false;\"><button type=\"submit\" class=\"button\">Transcript!</button></form></div></td><td><div style=\"float: left; padding-right:3%\"><form onsubmit=\"accept_transcription_image(1); return false;\">Learn from sample <input type=\"checkbox\" name=\"img_OL-checkbox_\"1\" id=\"img_ol_checkbox_0\" value=\"True\" checked> <button type=\"submit\" class=\"button\">Accept transcription</button></form></div></td></tr><tr><td style=\"text-align:right; padding-right:3%\"><div style=\"margin-left:7%\">Image #3</div></td></tr><tr><td style=\"text-align:right; padding-right:3%\">  <img style=\"height: 80%; width: 80%; max-height: 420px; object-fit: contain\" id=\"img_2\" vid_idx=2 src=\"Flickr8k_samples/311146855_0b65fdb169.jpg\" alt=\"Image_3\"> </td><td><div style=\"margin-left:7% class=\"source item\"><textarea name=\"img_hypothesis_2\" id=\"img_hypothesis_2\"placeholder=\"Click in the transcript button to obtain a transcription.\"></textarea></div></td></tr><tr><td><div style=\"float: right; padding-right:3%\"><form onsubmit=\"write_interactive_caption_image(2); return false;\"><button type=\"submit\" class=\"button\">Transcript!</button></form></div></td><td><div style=\"float: left; padding-right:3%\"><form onsubmit=\"accept_transcription_image(2); return false;\">Learn from sample <input type=\"checkbox\" name=\"img_OL-checkbox_\"2\" id=\"img_ol_checkbox_0\" value=\"True\" checked> <button type=\"submit\" class=\"button\">Accept transcription</button></form></div></td></tr><tr><td style=\"text-align:right; padding-right:3%\"><div style=\"margin-left:7%\">Image #4</div></td></tr><tr><td style=\"text-align:right; padding-right:3%\"> <img style=\"height: 80%; width: 80%;  max-height: 420px; object-fit: contain\" id=\"img_3\" vid_idx=3 src=\"Flickr8k_samples/1258913059_07c613f7ff.jpg\" alt=\"Image_4\"></td><td><div style=\"margin-left:7% class=\"source item\"><textarea name=\"img_hypothesis_3\" id=\"img_hypothesis_3\"placeholder=\"Click in the transcript button to obtain a transcription.\"></textarea></div></td></tr><tr><td><div style=\"float: right; padding-right:3%\"><form onsubmit=\"write_interactive_caption_image(3); return false;\"><button type=\"submit\" class=\"button\">Transcript!</button></form></div></td><td><div style=\"float: left; padding-right:3%\"><form onsubmit=\"accept_transcription_image(3); return false;\">Learn from sample <input type=\"checkbox\" name=\"img_OL-checkbox_\"3\" id=\"img_ol_checkbox_0\" value=\"True\" checked> <button type=\"submit\" class=\"button\">Accept transcription</button></form></div></td></tr><tr><td style=\"text-align:right; padding-right:3%\"><div style=\"margin-left:7%\">Image #5</div></td></tr><tr><td style=\"text-align:right; padding-right:3%\">  <img style=\"height: 80%; width: 80%;  max-height: 420px; object-fit: contain\" id=\"img_4\" vid_idx=4 src=\"Flickr8k_samples/241347760_d44c8d3a01.jpg\" alt=\"Image_5\"></td><td><div style=\"margin-left:7% class=\"source item\"><textarea name=\"img_hypothesis_4\" id=\"img_hypothesis_4\"placeholder=\"Click in the transcript button to obtain a transcription.\"></textarea></div></td></tr><tr><td><div style=\"float: right; padding-right:3%\"><form onsubmit=\"write_interactive_caption_image(4); return false;\"><button type=\"submit\" class=\"button\">Transcript!</button></form></div></td><td><div style=\"float: left; padding-right:3%\"><form onsubmit=\"accept_transcription_image(4); return false;\">Learn from sample <input type=\"checkbox\" name=\"img_OL-checkbox_\"4\" id=\"img_ol_checkbox_0\" value=\"True\" checked> <button type=\"submit\" class=\"button\">Accept transcription</button></form></div></td></tr></table>";



        if (url == 'msvd'){
            DisplayArea.innerHTML = msvd_table;
        }
        if (url == 'flickr8k'){
            DisplayArea.innerHTML = flick8k_table;
        }
}
</script>

<!--External-->

<script src="assets/js/main.js"></script>


</html>